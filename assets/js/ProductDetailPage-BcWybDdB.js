import{j as e,A as s,B as a,F as r,M as i}from"./vendor-ui-Dyuh2GWT.js";import{u as l,c as t,a as n,L as d}from"./vendor-react-B8YbCJDS.js";import{u as c,d as o,e as u,b as m,f as h,h as p}from"./index-m5a3JCQu.js";import"./vendor-leaflet-BYmSvtXk.js";import"./vendor-supabase-C9cCqp-Z.js";const x=()=>{const{standId:x,productId:j}=l(),b=t(),{user:v}=c(),f="new"===j,[g,w]=n.useState(null),[y,N]=n.useState(null),[P,S]=n.useState(!0),[C,E]=n.useState(!1),[k,D]=n.useState(null),[_,F]=n.useState(null),[$,I]=n.useState({name:"",description:"",price:"",is_available:!0}),[L,G]=n.useState(null),[q,A]=n.useState(null),[T,B]=n.useState(!1),[U,R]=n.useState(!1),[M,O]=n.useState(!1);n.useEffect((()=>{(async()=>{try{S(!0);const{data:e,error:s}=await o(x);if(s)throw new Error(s.message);if(!e)throw new Error("Stand not found");if(e.owner_id!==v.id)throw new Error("You do not have permission to view this stand");if(w(e),!f&&e.products){const s=e.products.find((e=>e.id===j));if(!s)throw new Error("Product not found");N(s),I({name:s.name||"",description:s.description||"",price:s.price||"",is_available:s.is_available})}}catch(e){D(e.message)}finally{S(!1)}})()}),[x,j,v.id,f]);const Y=e=>{const{name:s,value:a,type:r,checked:i}=e.target;I((e=>({...e,[s]:"checkbox"===r?i:a})))};return P?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-lemonade-blue"})})}):k&&!g?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx(s,{variant:"error",className:"mb-4",children:k}),e.jsx(d,{to:"/seller/dashboard",children:e.jsx(a,{variant:"secondary",children:"Back to Dashboard"})})]}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(d,{to:`/seller/stands/${x}`,className:"text-lemonade-blue hover:underline mb-2 inline-block",children:["â† Back to ",g.name]}),e.jsx("h1",{className:"text-3xl font-display text-lemonade-blue-dark",children:f?"Add New Product":`Edit ${(null==y?void 0:y.name)||"Product"}`})]}),k&&e.jsx(s,{variant:"error",className:"mb-4",dismissible:!0,onDismiss:()=>D(null),children:k}),_&&e.jsx(s,{variant:"success",className:"mb-4",dismissible:!0,onDismiss:()=>F(null),children:_}),e.jsx("div",{className:"bg-white rounded-xl shadow-md p-6",children:e.jsxs(r,{onSubmit:async e=>{e.preventDefault(),E(!0),D(null),F(null);try{const e=parseFloat($.price);if(isNaN(e)||e<=0)throw new Error("Please enter a valid price");const s={...$,price:e,stand_id:x};let a;if(f){const{data:e,error:r}=await u(s);if(r)throw new Error(r.message);a=e[0],N(a)}else{const{data:e,error:r}=await m(j,s);if(r)throw new Error(r.message);a=e[0],N(a)}if(L&&a){B(!0);const{error:e}=await h(a.id,x,v.id,L);if(e)throw new Error(`Error uploading image: ${e.message}`);const{data:s,error:r}=await o(x);if(r)throw new Error(r.message);const i=s.products.find((e=>e.id===a.id));i&&N(i)}F(f?"Product created successfully!":"Product updated successfully!"),f&&b(`/seller/stands/${x}/products/${a.id}`,{replace:!0,state:{message:"Product created successfully!"}}),G(null),A(null)}catch(s){D(s.message)}finally{E(!1),B(!1)}},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("div",{className:"rounded-lg overflow-hidden border border-gray-200 mb-4",children:q?e.jsx("img",{src:q,alt:"Preview",className:"w-full h-64 object-cover"}):(null==y?void 0:y.image_url)?e.jsx("img",{src:y.image_url,alt:y.name,className:"w-full h-64 object-cover"}):e.jsx("div",{className:"w-full h-64 bg-lemonade-yellow-light flex items-center justify-center",children:e.jsx("span",{className:"text-lemonade-yellow-dark",children:"No Image"})})}),e.jsxs(r.Group,{children:[e.jsx(r.Label,{htmlFor:"image",children:"Product Image"}),e.jsx(r.Input,{id:"image",name:"image",type:"file",accept:"image/*",onChange:e=>{const s=e.target.files[0];if(s){G(s);const e=new FileReader;e.onloadend=()=>{A(e.result)},e.readAsDataURL(s)}}}),e.jsx(r.Text,{children:"Upload an image of your product."})]}),e.jsxs(r.Group,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(r.Checkbox,{id:"is_available",name:"is_available",checked:$.is_available,onChange:Y}),e.jsx(r.Label,{htmlFor:"is_available",className:"ml-2 mb-0",children:"Product is available"})]}),e.jsx(r.Text,{children:"Unavailable products are not shown to customers."})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs(r.Group,{children:[e.jsx(r.Label,{htmlFor:"name",required:!0,children:"Product Name"}),e.jsx(r.Input,{id:"name",name:"name",value:$.name,onChange:Y,placeholder:"Enter product name",required:!0})]}),e.jsxs(r.Group,{children:[e.jsx(r.Label,{htmlFor:"description",children:"Description"}),e.jsx(r.Textarea,{id:"description",name:"description",value:$.description,onChange:Y,placeholder:"Describe your product",rows:4})]}),e.jsxs(r.Group,{children:[e.jsx(r.Label,{htmlFor:"price",required:!0,children:"Price ($)"}),e.jsx(r.Input,{id:"price",name:"price",type:"number",step:"0.01",min:"0.01",value:$.price,onChange:Y,placeholder:"Enter price",required:!0})]})]})]}),e.jsxs("div",{className:"flex justify-between mt-6",children:[!f&&e.jsx(a,{type:"button",variant:"danger",onClick:()=>R(!0),children:"Delete Product"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(d,{to:`/seller/stands/${x}`,children:e.jsx(a,{type:"button",variant:"secondary",disabled:C||T,children:"Cancel"})}),e.jsx(a,{type:"submit",variant:"primary",disabled:C||T,children:C||T?f?"Creating...":"Saving...":f?"Create Product":"Save Changes"})]})]})]})}),e.jsx(i,{isOpen:U,onClose:()=>R(!1),title:"Delete Product",children:e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-gray-700 mb-6",children:"Are you sure you want to delete this product? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(a,{variant:"secondary",onClick:()=>R(!1),disabled:M,children:"Cancel"}),e.jsx(a,{variant:"danger",onClick:async()=>{O(!0);try{const{error:e}=await p(j);if(e)throw new Error(e.message);b(`/seller/stands/${x}`,{state:{message:"Product deleted successfully!"}})}catch(e){D(e.message),R(!1)}finally{O(!1)}},disabled:M,children:M?"Deleting...":"Delete Product"})]})]})})]})};export{x as default};
//# sourceMappingURL=ProductDetailPage-BcWybDdB.js.map
